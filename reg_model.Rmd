---
title: "Регрессионая модель"
author: "Ядонист Роман"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
---

Загрузим данные
```{r echo=FALSE, include=FALSE}
setwd('/Users/yadonistroman/Documents/GitHub/trustus-r/data')
library(tidyverse)
library(readxl)
library(stargazer)
df <- read_excel('total.xlsx')
```

Добавим столбец с временем года
```{r echo=FALSE, include=FALSE}
season_v <- rep(c('зима', 'весна', 'лето', 'осень'), each=3)
season_v <- season_v[2:12]
season_v <- c(season_v, season_v[1])
season_v <- rep(season_v, 83)

df <- df %>% add_column('Сезон' = season_v, .before = 'Квартал')
```

1. Поcтроим регрессионную модель, которая позволяет выяснить:
 - каким образом потребительская активность зависит от средней заработной платы в регионе, 
числа активных абонентов беспроводного наземного фиксированного доступа к сети Интернет и
уровня безработицы населения.
```{r echo=FALSE, include=FALSE}
# для нашей цели линейной регрессии будет достачно

mod_reg_pa <- lm(data = df, Индекс.ПА ~ `Среднемесячная з.п.` + 
                   `Число абонентов` + `Уровень безработицы` + Сезон)
summary(mod_reg_pa)
```
```{r echo=FALSE}
stargazer(mod_reg_pa, type = 'text')
```

 - каким образом доля безналичных платежей в торговом обороте зависит от средней заработной 
платы в регионе, числа активных абонентов беспроводного наземного фиксированного доступа к 
сети Интернет и уровня безработицы населения.
```{r echo=FALSE, include=FALSE}
# построим линейную регрессию

mod_reg_bp <- lm(data = df, Индекс.БП ~ `Среднемесячная з.п.` + `Число абонентов` + `Уровень безработицы` + Сезон)
summary(mod_reg_bp)
stargazer(mod_reg_bp, type = 'text')
```
```{r echo=FALSE}
stargazer(mod_reg_bp, type = 'text')
```

2. Добавим столбец в датафрейм из 0 и 1. Где за 1 будем считать, что доля онлайн-заявок больше 50%. И он
будет показывать склонность населения к онлайн сервисам банка.
```{r echo=FALSE, include=FALSE}
df <- df %>% mutate(`Онлайн-заявки dummy` = ifelse(`Онлайн-заявки` > `Офлайн-заявки`, 1, 0))
```

3. Добавим столец в датафрейм также из 0 и 1. Где за 1 бедем считать количество ипотечных сделок в регионах
больше 500. Этот столбец будет показывать склонность населиня оформлять ипотеку.
```{r echo=FALSE, include=FALSE}
# поработаем со шкалой данных столбца 'всего ипотечных сделолк'
# разделим на начальное и конечное значение и возьмем только начальное значение
# и сравним с порогом в 500 сделок на регион

df_ipot <- df %>% select(Регион, `Всего ипотечных сделок`)
df_ipot$`Всего ипотечных сделок` <- gsub(' ', '', df_ipot$`Всего ипотечных сделок`)
df_ipot$`Всего ипотечных сделок` <- gsub('>', '', df_ipot$`Всего ипотечных сделок`)
ipot_list <- strsplit(df_ipot$`Всего ипотечных сделок`, '-')

ipot_v <- c()
for (i in ipot_list) {
  ipot_v <- c(ipot_v, i[1])
}

df_ipot$`Всего ипотечных сделок` <- as.numeric(ipot_v)
df_ipot <- df_ipot %>% mutate(`Ипотечые сделки dummy` = ifelse(`Всего ипотечных сделок` >= 500, 1, 0))
df$`Ипотечые сделки dummy` <- df_ipot$`Ипотечые сделки dummy`
```

4. Построим регрессионную модель, которая позволит выяснить, каким образом склонность населения предпочитать 
онлайн-услуги банка зависит от средней заработной платы в регионе, числа активных абонентов беспроводного 
наземного фиксированного доступа к сети Интернет и уровня безработицы населения.
```{r echo=FALSE, include=FALSE}
# для предсказания бинарной целевой переменной воспользуемся логистической регрессией
mod_lreg_online <- glm(data = df, `Онлайн-заявки dummy` ~ `Среднемесячная з.п.` + 
                         `Число абонентов` + 
                         `Уровень безработицы` +
                         Сезон, 
                       family = 'binomial')
summary(mod_lreg_online)
exp(coef(mod_lreg_online))
```
```{r echo=FALSE}
stargazer(mod_lreg_online, type = 'text')
```

5. Построим регрессионную модель, которая позволит выяснить, каким образом склонность населения оформлять 
ипотеку зависит от средней заработной платы в регионе, числа активных абонентов беспроводного наземного 
фиксированного доступа к сети Интернет и уровня безработицы населения.
```{r echo=FALSE, include=FALSE}
# воспользуемся логистической регрессией
mod_lreg_ipot <- glm(data = df, `Ипотечые сделки dummy` ~ `Среднемесячная з.п.` + 
                         `Число абонентов` + 
                         `Уровень безработицы` +
                         Сезон, 
                       family = 'binomial')
summary(mod_lreg_ipot)
exp(coef(mod_lreg_ipot))
```
```{r echo=FALSE}
stargazer(mod_lreg_ipot, type = 'text')
```








